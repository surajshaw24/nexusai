<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NexusAI — Advanced AI Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6C5CE7;
            --secondary: #A29BFE;
            --text: #2D3436;
            --bg: #F5F6FA;
            --card-bg: #FFFFFF;
            --input-bg: #FFFFFF;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --hover-effect: brightness(0.95);
            --success: #00B894;
            --warning: #FDCC5D;
            --error: #D63031;
            --border-radius: 18px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark-mode {
            --primary: #A78BFA;
            --secondary: #7E57C2;
            --text: #ECF0F1;
            --bg: #1A1A2E;
            --card-bg: #16213E;
            --input-bg: #0F3460;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            --hover-effect: brightness(1.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            transition: var(--transition);
        }

        body {
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-weight: 700;
            font-size: 1.4rem;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--input-bg);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text);
            font-size: 1.1rem;
            transition: transform 0.2s, background 0.3s;
            position: relative;
        }

        .header-btn:hover {
            filter: var(--hover-effect);
            transform: scale(1.05);
            background: rgba(108, 92, 231, 0.1);
        }

        .auth-buttons {
            display: flex;
            gap: 8px;
        }

        .auth-btn {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }

        .login-btn {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .login-btn:hover {
            background: rgba(108, 92, 231, 0.1);
        }

        .signup-btn {
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
        }

        .signup-btn:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }

        .user-avatar::after {
            content: '';
            position: absolute;
            inset: 0;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .user-avatar:hover::after {
            opacity: 1;
        }

        /* Chat Container */
        .chat-container {
            height: calc(100vh - 140px);
            overflow-y: auto;
            padding: 20px;
            scroll-behavior: smooth;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(108, 92, 231, 0.03) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(162, 155, 254, 0.03) 0%, transparent 20%);
            background-size: 300px 300px;
            background-position: 0 0, 100% 100%;
            background-repeat: no-repeat;
            position: relative;
        }

        /* Messages */
        .message {
            margin-bottom: 20px;
            max-width: 85%;
            animation: fadeIn 0.4s ease;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            margin-left: auto;
            align-items: flex-end;
        }

        .ai-message {
            margin-right: auto;
            align-items: flex-start;
        }

        .message-bubble {
            padding: 14px 18px;
            border-radius: var(--border-radius);
            line-height: 1.6;
            font-size: 0.95rem;
            position: relative;
            max-width: 100%;
            word-wrap: break-word;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            overflow-wrap: break-word;
        }

        .user-message .message-bubble {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-top-right-radius: 4px;
            box-shadow: 0 4px 12px rgba(108, 92, 231, 0.3);
        }

        .ai-message .message-bubble {
            background: var(--card-bg);
            border-top-left-radius: 4px;
            border: 1px solid rgba(0,0,0,0.05);
        }

        .dark-mode .ai-message .message-bubble {
            border-color: rgba(255,255,255,0.1);
        }

        .message-bubble img {
            max-width: 100%;
            border-radius: 12px;
            margin: 10px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.05);
        }

        .dark-mode .message-bubble img {
            border-color: rgba(255,255,255,0.1);
        }

        .message-sender {
            font-size: 0.75rem;
            color: var(--text);
            opacity: 0.8;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .message-time {
            font-size: 0.7rem;
            opacity: 0.6;
            margin-top: 4px;
        }

        .message-actions {
            display: flex;
            gap: 6px;
            margin-top: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action-btn {
            background: none;
            border: none;
            color: var(--text);
            cursor: pointer;
            font-size: 0.8rem;
            padding: 4px;
            border-radius: 4px;
            opacity: 0.7;
        }

        .message-action-btn:hover {
            opacity: 1;
            background: rgba(0,0,0,0.05);
        }

        .dark-mode .message-action-btn:hover {
            background: rgba(255,255,255,0.05);
        }

        /* Typing Indicator */
        .typing-indicator {
            display: inline-flex;
            gap: 6px;
            align-items: center;
            margin-top: 8px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.7);
            animation: typingAnimation 1.4s infinite both;
        }

        .ai-message .typing-dot {
            background: var(--primary);
        }

        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-4px); }
        }

        /* Code Block Styling */
        .code-block {
            background: #f6f8fa;
            border-radius: 8px;
            padding: 12px;
            margin: 12px 0;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            border-left: 4px solid var(--primary);
        }

        .dark-mode .code-block {
            background: #1e293b;
            border-left-color: var(--secondary);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.8rem;
            color: #666;
        }

        .copy-code-btn {
            background: transparent;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .copy-code-btn:hover {
            background: rgba(0,0,0,0.05);
            color: var(--primary);
        }

        .dark-mode .copy-code-btn:hover {
            background: rgba(255,255,255,0.05);
        }

        /* Input Area */
        .input-area {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
            z-index: 50;
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .dark-mode .input-area {
            border-top-color: rgba(255,255,255,0.05);
        }

        .input-wrapper {
            flex: 1;
            background: var(--input-bg);
            border-radius: 24px;
            padding: 4px 16px;
            display: flex;
            align-items: center;
            border: 1px solid rgba(0,0,0,0.1);
            transition: all 0.3s;
            min-height: 48px;
        }

        .dark-mode .input-wrapper {
            border-color: rgba(255,255,255,0.1);
        }

        .input-wrapper:focus-within {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(108, 92, 231, 0.2);
        }

        .input-field {
            flex: 1;
            border: none;
            background: transparent;
            color: var(--text);
            font-size: 1rem;
            outline: none;
            resize: none;
            max-height: 120px;
            padding: 10px 0;
            line-height: 1.5;
            min-height: 40px;
            overflow-y: auto;
        }

        .input-field::placeholder {
            color: var(--text);
            opacity: 0.5;
        }

        .input-actions {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .input-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: transparent;
            border: none;
            color: var(--text);
            opacity: 0.7;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.2s;
        }

        .input-btn:hover {
            opacity: 1;
            background: rgba(0, 0, 0, 0.05);
            transform: scale(1.05);
        }

        .dark-mode .input-btn:hover {
            background: rgba(255,255,255,0.05);
        }

        .send-btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            opacity: 1 !important;
            box-shadow: 0 2px 10px rgba(108, 92, 231, 0.3);
            transition: all 0.3s;
        }

        .send-btn:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 92, 231, 0.4);
        }

        /* Voice Assistant Animation */
        .voice-assistant {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 20px rgba(108, 92, 231, 0.3);
            cursor: pointer;
            z-index: 100;
            animation: pulse 2s infinite;
            transition: all 0.3s;
            border: 2px solid white;
        }

        .dark-mode .voice-assistant {
            border-color: var(--card-bg);
        }

        .voice-assistant:hover {
            transform: scale(1.1);
        }

        .voice-assistant.listening {
            animation: pulse 0.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(108, 92, 231, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(108, 92, 231, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(108, 92, 231, 0); }
        }

        /* Image Attachment Preview */
        .attachment-preview {
            display: none;
            position: fixed;
            bottom: 80px;
            left: 20px;
            right: 20px;
            background: var(--card-bg);
            border-radius: 12px;
            padding: 12px;
            box-shadow: var(--shadow);
            z-index: 80;
            max-height: 200px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .attachment-preview img {
            max-width: 100%;
            max-height: 160px;
            border-radius: 8px;
            display: block;
            margin: 8px auto;
        }

        .close-preview {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0,0,0,0.2);
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* Loading Skeletons */
        .skeleton {
            background: linear-gradient(to right, #f0f0f0, #e0e0e0, #f0f0f0);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 8px;
        }

        .skeleton-text {
            height: 16px;
            margin-bottom: 8px;
            border-radius: 4px;
        }

        .skeleton-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        @keyframes shimmer {
            0% { background-position: -468px 0 }
            100% { background-position: 468px 0 }
        }

        .dark-mode .skeleton {
            background: linear-gradient(to right, #2a2a3a, #3a3a4a, #2a2a3a);
        }

        /* Login Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 16px;
            width: 90%;
            max-width: 480px;
            padding: 32px;
            box-shadow: var(--shadow);
            animation: modalFadeIn 0.3s ease;
            overflow: hidden;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 600;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text);
            opacity: 0.7;
            padding: 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text);
        }

        .form-input {
            width: 100%;
            padding: 14px 18px;
            border-radius: 10px;
            border: 1px solid rgba(0,0,0,0.1);
            background: var(--input-bg);
            color: var(--text);
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .dark-mode .form-input {
            border-color: rgba(255,255,255,0.1);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(108, 92, 231, 0.2);
        }

        .submit-btn {
            width: 100%;
            padding: 14px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            color: white;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            margin-top: 12px;
            transition: all 0.2s;
            letter-spacing: 0.5px;
        }

        .submit-btn:hover {
            filter: brightness(1.1);
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(108, 92, 231, 0.3);
        }

        .form-footer {
            margin-top: 20px;
            text-align: center;
            font-size: 0.9rem;
        }

        .switch-form {
            color: var(--primary);
            cursor: pointer;
            font-weight: 600;
            transition: color 0.2s;
        }

        .switch-form:hover {
            text-decoration: underline;
        }

        /* Sidebar (for chat history) */
        .sidebar {
            position: fixed;
            top: 70px;
            left: 0;
            height: calc(100vh - 70px);
            width: 280px;
            background: var(--card-bg);
            box-shadow: var(--shadow);
            z-index: 90;
            transition: transform 0.3s;
            transform: translateX(-100%);
            overflow-y: auto;
            padding: 16px;
            display: none;
        }

        .dark-mode .sidebar {
            background: var(--bg);
            border-right: 1px solid rgba(255,255,255,0.05);
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        .sidebar-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .toggle-sidebar-btn {
            background: none;
            border: none;
            color: var(--text);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 4px;
        }

        .chat-history-item {
            padding: 12px 14px;
            border-radius: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .chat-history-item:hover {
            background: rgba(108, 92, 231, 0.05);
        }

        .chat-history-title {
            font-size: 0.9rem;
            font-weight: 500;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .chat-history-time {
            font-size: 0.7rem;
            color: var(--text);
            opacity: 0.6;
        }

        .new-chat-btn {
            width: 100%;
            padding: 12px;
            background: var(--input-bg);
            border: 1px dashed var(--primary);
            border-radius: 10px;
            color: var(--primary);
            font-weight: 500;
            cursor: pointer;
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .new-chat-btn:hover {
            background: rgba(108, 92, 231, 0.1);
        }

        /* Export Button */
        .export-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            box-shadow: var(--shadow);
            z-index: 80;
            cursor: pointer;
            opacity: 0.8;
            transition: all 0.3s;
        }

        .export-btn:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .header {
                padding: 12px 16px;
            }
            
            .logo {
                font-size: 1.2rem;
            }
            
            .auth-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
            
            .chat-container {
                padding: 16px;
                height: calc(100vh - 130px);
            }
            
            .input-area {
                padding: 10px 12px;
            }
            
            .voice-assistant {
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
                bottom: 90px;
                right: 16px;
            }
            
            .modal-content {
                padding: 24px;
            }
        }

        @media (min-width: 1024px) {
            .chat-container {
                padding: 24px 40px;
            }
            
            .sidebar {
                display: block;
                transform: translateX(0);
            }
            
            .input-area {
                padding: 16px 24px;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            white-space: nowrap;
            border: 0;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card-bg);
            color: var(--text);
            padding: 12px 20px;
            border-radius: 24px;
            box-shadow: var(--shadow);
            z-index: 200;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--error);
        }

        .toast i {
            font-size: 1rem;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h3 class="sidebar-title">Chat History</h3>
            <button class="toggle-sidebar-btn" id="closeSidebar"><i class="fas fa-times"></i></button>
        </div>

        <div id="historyList">
            <!-- Dynamically populated -->
        </div>

        <button class="new-chat-btn" id="newChatBtn">
            <i class="fas fa-plus"></i> New Chat
        </button>
    </aside>

    <!-- Header -->
    <div class="header">
        <div class="logo">
            <span class="logo-icon">N</span>
            NexusAI
        </div>
        <div class="header-actions">
            <button class="header-btn" id="themeToggle" aria-label="Toggle theme">
                <i class="fas fa-moon"></i>
            </button>
            <button class="header-btn" id="toggleSidebar" aria-label="Toggle chat history">
                <i class="fas fa-list"></i>
            </button>
            <div class="user-avatar" id="userAvatar">U</div>
        </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-container" id="chatContainer">
        <div class="message ai-message">
            <div class="message-sender">
                <i class="fas fa-robot"></i>
                NexusAI
            </div>
            <div class="message-bubble">
                <p>Hello! I'm your advanced AI assistant. I can help you with coding, analysis, creative writing, or just chat. Try asking me something like:</p>
                <ul style="margin: 12px 0;">
                    <li>“Explain quantum computing simply”</li>
                    <li>“Write Python code for data visualization”</li>
                    <li>“What’s the future of AI?”</li>
                </ul>
                <img src="https://source.unsplash.com/random/300x200/?ai,technology" alt="AI Technology" onerror="this.style.display='none'" style="max-width: 100%; margin-top: 16px;">
            </div>
            <div class="message-time">Just now</div>
        </div>
    </div>

    <!-- Image Attachment Preview -->
    <div class="attachment-preview" id="attachmentPreview">
        <button class="close-preview" id="closePreview"><i class="fas fa-times"></i></button>
        <img id="previewImage" src="" alt="Preview">
        <p id="previewCaption" style="margin-top: 8px; font-size: 0.8rem; color: var(--text); opacity: 0.7;">Uploaded image</p>
    </div>

    <!-- Input Area -->
    <div class="input-area">
        <div class="input-wrapper">
            <textarea class="input-field" id="messageInput" placeholder="Ask me anything..." rows="1" aria-label="Message input" autocomplete="off"></textarea>
        </div>
        <div class="input-actions">
            <button class="input-btn" id="attachBtn" title="Attach Image" aria-label="Attach image">
                <i class="fas fa-image"></i>
            </button>
            <button class="input-btn" id="voiceBtn" title="Voice Input" aria-label="Voice input">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="input-btn send-btn" id="sendBtn" title="Send message" aria-label="Send message">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- Voice Assistant Button -->
    <div class="voice-assistant" id="voiceAssistant">
        <i class="fas fa-microphone"></i>
    </div>

    <!-- Export Button -->
    <button class="export-btn" id="exportBtn" title="Export conversation" aria-label="Export chat">
        <i class="fas fa-download"></i>
    </button>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Login to NexusAI</div>
                <button class="close-modal" id="closeLoginModal">&times;</button>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="loginEmail">Email</label>
                    <input type="email" class="form-input" id="loginEmail" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label class="form-label" for="loginPassword">Password</label>
                    <input type="password" class="form-input" id="loginPassword" required autocomplete="current-password">
                </div>
                <button type="submit" class="submit-btn">Sign In</button>
                <div class="form-footer">
                    Don't have an account? <span class="switch-form" id="showSignup">Create Account</span>
                </div>
            </form>
        </div>
    </div>

    <!-- Signup Modal -->
    <div class="modal" id="signupModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Create Your Account</div>
                <button class="close-modal" id="closeSignupModal">&times;</button>
            </div>
            <form id="signupForm">
                <div class="form-group">
                    <label class="form-label" for="signupName">Full Name</label>
                    <input type="text" class="form-input" id="signupName" required autocomplete="name">
                </div>
                <div class="form-group">
                    <label class="form-label" for="signupEmail">Email</label>
                    <input type="email" class="form-input" id="signupEmail" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label class="form-label" for="signupPassword">Password</label>
                    <input type="password" class="form-input" id="signupPassword" required autocomplete="new-password">
                </div>
                <div class="form-group">
                    <label class="form-label" for="signupConfirmPassword">Confirm Password</label>
                    <input type="password" class="form-input" id="signupConfirmPassword" required autocomplete="new-password">
                </div>
                <button type="submit" class="submit-btn">Create Account</button>
                <div class="form-footer">
                    Already have an account? <span class="switch-form" id="showLogin">Sign In</span>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastText"></span>
    </div>

    <script>
        // DOM Elements
        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const themeToggle = document.getElementById('themeToggle');
        const voiceAssistant = document.getElementById('voiceAssistant');
        const attachBtn = document.getElementById('attachBtn');
        const attachmentPreview = document.getElementById('attachmentPreview');
        const previewImage = document.getElementById('previewImage');
        const previewCaption = document.getElementById('previewCaption');
        const closePreview = document.getElementById('closePreview');
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const loginModal = document.getElementById('loginModal');
        const signupModal = document.getElementById('signupModal');
        const closeLoginModal = document.getElementById('closeLoginModal');
        const closeSignupModal = document.getElementById('closeSignupModal');
        const showSignup = document.getElementById('showSignup');
        const showLogin = document.getElementById('showLogin');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const sidebar = document.getElementById('sidebar');
        const toggleSidebar = document.getElementById('toggleSidebar');
        const closeSidebar = document.getElementById('closeSidebar');
        const historyList = document.getElementById('historyList');
        const newChatBtn = document.getElementById('newChatBtn');
        const exportBtn = document.getElementById('exportBtn');
        const toast = document.getElementById('toast');
        const toastText = document.getElementById('toastText');

        // App State
        let isDarkMode = false;
        let isListening = false;
        let recognition;
        let selectedImage = null;
        let currentSessionId = generateSessionId();
        let conversationHistory = [];
        let isTyping = false;
        let currentUser = null;

        // Initialize Speech Recognition
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onstart = () => {
                isListening = true;
                voiceAssistant.innerHTML = '<i class="fas fa-microphone-slash"></i>';
                voiceAssistant.classList.add('listening');
                addMessage('ai', 'Listening... Speak clearly.');
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript.trim();
                messageInput.value = transcript;
                sendMessage();
            };

            recognition.onerror = (event) => {
                console.warn('Speech recognition error:', event.error);
                addMessage('ai', 'Voice input failed. Please try again or use text.');
            };

            recognition.onend = () => {
                isListening = false;
                voiceAssistant.innerHTML = '<i class="fas fa-microphone"></i>';
                voiceAssistant.classList.remove('listening');
            };
        } else {
            document.getElementById('voiceBtn').style.display = 'none';
            voiceAssistant.style.display = 'none';
        }

        // Toggle Dark/Light Mode
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            localStorage.setItem('darkMode', isDarkMode);
            showToast('Theme toggled', 'success');
        }

        // Check system preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            isDarkMode = true;
            document.body.classList.add('dark-mode');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }

        // Load saved theme
        const savedTheme = localStorage.getItem('darkMode');
        if (savedTheme === 'true') {
            isDarkMode = true;
            document.body.classList.add('dark-mode');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }

        // Load user session
        const savedUser = localStorage.getItem('nexusUser');
        if (savedUser) {
            currentUser = JSON.parse(savedUser);
            updateUIForUser(currentUser);
            loadConversationHistory();
        }

        // Theme Toggle Event
        themeToggle.addEventListener('click', toggleTheme);

        // Sidebar Toggle
        toggleSidebar.addEventListener('click', () => {
            sidebar.classList.toggle('open');
        });

        closeSidebar.addEventListener('click', () => {
            sidebar.classList.remove('open');
        });

        // Image Attachment Handling
        attachBtn.addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        selectedImage = event.target.result;
                        previewImage.src = selectedImage;
                        previewCaption.textContent = file.name;
                        attachmentPreview.style.display = 'flex';
                        addMessage('ai', `You've attached "${file.name}". I can analyze this image.`);
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        });

        closePreview.addEventListener('click', () => {
            attachmentPreview.style.display = 'none';
            selectedImage = null;
        });

        // Send Message Function
        async function sendMessage() {
            if (isTyping) return;
            const message = messageInput.value.trim();
            if (!message && !selectedImage) return;

            // Disable input during processing
            isTyping = true;
            messageInput.disabled = true;
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            // Add user message
            addMessage('user', message);
            if (selectedImage) {
                const lastMsg = chatContainer.lastElementChild;
                const bubble = lastMsg.querySelector('.message-bubble');
                const img = document.createElement('img');
                img.src = selectedImage;
                img.alt = 'User uploaded image';
                img.style.maxWidth = '100%';
                img.style.marginTop = '12px';
                img.onerror = () => {
                    const errorMsg = document.createElement('p');
                    errorMsg.textContent = '[Image failed to load]';
                    errorMsg.style.fontStyle = 'italic';
                    errorMsg.style.opacity = '0.7';
                    bubble.appendChild(errorMsg);
                };
                bubble.appendChild(img);
                selectedImage = null;
                attachmentPreview.style.display = 'none';
            }

            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            messageInput.focus();

            // Show typing indicator
            const typingId = showTypingIndicator();

            // Simulate AI response stream
            setTimeout(() => {
                removeTypingIndicator(typingId);
                streamResponse(message);
            }, 800);
        }

        // Streaming AI Response (Simulates LLM token-by-token)
        async function streamResponse(userMessage) {
            const responseDiv = document.createElement('div');
            responseDiv.className = 'message ai-message';
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            responseDiv.innerHTML = `
                <div class="message-sender">
                    <i class="fas fa-robot"></i>
                    NexusAI
                </div>
                <div class="message-bubble" id="streaming-response"></div>
                <div class="message-time">${time}</div>
                <div class="message-actions">
                    <button class="message-action-btn copy-btn" title="Copy"><i class="fas fa-copy"></i></button>
                    <button class="message-action-btn delete-btn" title="Delete"><i class="fas fa-trash"></i></button>
                </div>
            `;
            chatContainer.appendChild(responseDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;

            const responseBubble = document.getElementById('streaming-response');
            const fullResponse = await generateStreamingResponse(userMessage);
            let displayedText = '';

            // Stream character by character
            for (let i = 0; i <= fullResponse.length; i++) {
                displayedText = fullResponse.substring(0, i);
                responseBubble.innerHTML = formatResponse(displayedText);
                await new Promise(r => setTimeout(r, 10)); // Delay per char
            }

            // Enable buttons
            isTyping = false;
            messageInput.disabled = false;
            sendBtn.disabled = false;
            sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';

            // Save to history
            saveConversation();
        }

        // Format response with markdown support
        function formatResponse(text) {
            // Code blocks
            text = text.replace(/```(\w+)?\n([\s\S]*?)```/g, (match, lang, code) => {
                const language = lang || 'plaintext';
                return `<div class="code-block"><div class="code-header"><span>${language}</span><button class="copy-code-btn" onclick="copyToClipboard('${code.replace(/'/g, "\\'")}')">Copy</button></div>${highlightCode(code, language)}</div>`;
            });

            // Bold
            text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            // Italic
            text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
            // Links
            text = text.replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" style="color: var(--primary); text-decoration: underline;">$1</a>');

            return text;
        }

        // Syntax highlighter (basic)
        function highlightCode(code, language) {
            if (language === 'javascript' || language === 'js') {
                return code.replace(/(\/\/.*$|\/\*[\s\S]*?\*\/|".*?"|'.*?'|\b(function|const|let|var|return|if|else|for|while|class|extends|import|export|default)\b)/gm, (match) => {
                    if (match.startsWith('//')) return `<span style="color: #6c757d;">${match}</span>`;
                    if (match.startsWith('/*')) return `<span style="color: #6c757d;">${match}</span>`;
                    if (match.startsWith('"') || match.startsWith("'")) return `<span style="color: #d35400;">${match}</span>`;
                    return `<span style="color: #2980b9;">${match}</span>`;
                });
            }
            return code;
        }

        // Mock AI response generator
        async function generateStreamingResponse(prompt) {
            // Simulate network delay
            await new Promise(r => setTimeout(r, 1000));

            const prompts = [
                "I've analyzed your request thoroughly. Here's what I found...",
                "Based on current research and best practices, I recommend:",
                "Let me break this down step by step:",
                "The most effective approach would be:",
                "Here's a comprehensive overview:"
            ];

            const baseResponses = [
                "Artificial intelligence is transforming every industry. From healthcare diagnostics to autonomous vehicles, AI enables systems to learn from data, adapt to new inputs, and perform human-like tasks.",
                "Here's a simple Python script to visualize data using matplotlib:\n\n```python\nimport matplotlib.pyplot as plt\n\nx = [1, 2, 3, 4]\ny = [10, 20, 25, 30]\nplt.plot(x, y)\nplt.title('Sample Plot')\nplt.xlabel('X-axis')\nplt.ylabel('Y-axis')\nplt.show()\n```",
                "Quantum computing leverages superposition and entanglement to solve problems exponentially faster than classical computers. While still emerging, companies like IBM and Google are already deploying quantum processors with over 100 qubits.",
                "When designing user interfaces, prioritize accessibility: use semantic HTML, ARIA labels, sufficient contrast ratios, and keyboard navigation. Tools like Lighthouse can audit your site.",
                "The future of AI lies in multimodal models that understand text, images, audio, and video together. This enables assistants like me to interpret complex queries involving multiple media types."
            ];

            const randomBase = baseResponses[Math.floor(Math.random() * baseResponses.length)];
            const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];

            return `${randomPrompt} ${randomBase}`;
        }

        // Copy to clipboard utility
        window.copyToClipboard = (text) => {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Copied to clipboard!', 'success');
            }).catch(err => {
                showToast('Failed to copy.', 'error');
            });
        };

        // Add message to chat
        function addMessage(sender, text) {
            const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const senderName = sender === 'user' ? 'You' : 'NexusAI';
            const avatarIcon = sender === 'user' ? 'fa-user' : 'fa-robot';

            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.innerHTML = `
                <div class="message-sender">
                    <i class="fas ${avatarIcon}"></i>
                    ${senderName}
                </div>
                <div class="message-bubble">${text}</div>
                <div class="message-time">${time}</div>
            `;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // Show typing indicator
        function showTypingIndicator() {
            const typingId = 'typing-' + Date.now();
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message';
            typingDiv.id = typingId;
            typingDiv.innerHTML = `
                <div class="message-sender">
                    <i class="fas fa-robot"></i>
                    NexusAI
                </div>
                <div class="message-bubble">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            chatContainer.appendChild(typingDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return typingId;
        }

        // Remove typing indicator
        function removeTypingIndicator(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        // Voice Assistant Click
        voiceAssistant.addEventListener('click', () => {
            if (!recognition) {
                showToast('Voice input not supported in this browser.', 'error');
                return;
            }
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        });

        // Voice Button Click
        document.getElementById('voiceBtn').addEventListener('click', () => {
            if (!recognition) {
                showToast('Voice input not supported.', 'error');
                return;
            }
            if (isListening) {
                recognition.stop();
            } else {
                recognition.start();
            }
        });

        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });

        // Send on Enter (without Shift)
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Send button click
        sendBtn.addEventListener('click', sendMessage);

        // Modal Handling
        loginBtn.addEventListener('click', () => loginModal.style.display = 'flex');
        signupBtn.addEventListener('click', () => signupModal.style.display = 'flex');

        closeLoginModal.addEventListener('click', () => loginModal.style.display = 'none');
        closeSignupModal.addEventListener('click', () => signupModal.style.display = 'none');

        showSignup.addEventListener('click', () => {
            loginModal.style.display = 'none';
            signupModal.style.display = 'flex';
        });

        showLogin.addEventListener('click', () => {
            signupModal.style.display = 'none';
            loginModal.style.display = 'flex';
        });

        window.addEventListener('click', (e) => {
            if (e.target === loginModal) loginModal.style.display = 'none';
            if (e.target === signupModal) signupModal.style.display = 'none';
        });

        // Form Submissions
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            // Simulate API call
            showToast('Logging in...', 'success');
            await new Promise(r => setTimeout(r, 1500));

            currentUser = { name: email.split('@')[0], email };
            localStorage.setItem('nexusUser', JSON.stringify(currentUser));
            updateUIForUser(currentUser);
            loginModal.style.display = 'none';
            loadConversationHistory();
            showToast(`Welcome back, ${currentUser.name}!`, 'success');
        });

        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirm = document.getElementById('signupConfirmPassword').value;

            if (password !== confirm) {
                showToast('Passwords do not match!', 'error');
                return;
            }

            showToast('Creating account...', 'success');
            await new Promise(r => setTimeout(r, 1500));

            currentUser = { name, email };
            localStorage.setItem('nexusUser', JSON.stringify(currentUser));
            updateUIForUser(currentUser);
            signupModal.style.display = 'none';
            loadConversationHistory();
            showToast(`Welcome aboard, ${name}!`, 'success');
        });

        // Update UI after login
        function updateUIForUser(user) {
            document.getElementById('userAvatar').textContent = user.name.charAt(0).toUpperCase();
            document.querySelectorAll('.auth-btn').forEach(btn => btn.style.display = 'none');
        }

        // Generate Session ID
        function generateSessionId() {
            return 'sess_' + Math.random().toString(36).substring(2, 15);
        }

        // Save conversation to localStorage
        function saveConversation() {
            const messages = Array.from(chatContainer.children).map(el => {
                const sender = el.classList.contains('user-message') ? 'user' : 'ai';
                const text = el.querySelector('.message-bubble').innerHTML;
                return { sender, text, time: new Date().toISOString() };
            });
            localStorage.setItem(`conversation_${currentSessionId}`, JSON.stringify(messages));
            addToHistory(currentSessionId, messages[0]?.text?.substring(0, 40) || 'New Chat');
        }

        // Load conversation history
        function loadConversationHistory() {
            historyList.innerHTML = '';
            const keys = Object.keys(localStorage).filter(k => k.startsWith('conversation_'));
            keys.forEach(key => {
                const sessionId = key.replace('conversation_', '');
                const messages = JSON.parse(localStorage.getItem(key));
                const firstMsg = messages[0]?.text || 'Empty';
                addToHistory(sessionId, firstMsg.substring(0, 40) + (firstMsg.length > 40 ? '...' : ''));
            });
        }

        function addToHistory(sessionId, title) {
            const item = document.createElement('div');
            item.className = 'chat-history-item';
            item.innerHTML = `
                <div class="chat-history-title">${title}</div>
                <div class="chat-history-time">${new Date().toLocaleDateString()}</div>
            `;
            item.addEventListener('click', () => {
                currentSessionId = sessionId;
                loadSession(sessionId);
            });
            historyList.prepend(item);
        }

        function loadSession(sessionId) {
            const messages = JSON.parse(localStorage.getItem(`conversation_${sessionId}`)) || [];
            chatContainer.innerHTML = '';
            messages.forEach(msg => {
                addMessage(msg.sender, msg.text);
            });
            sidebar.classList.remove('open');
            showToast('Loaded previous chat', 'success');
        }

        // Export Conversation
        exportBtn.addEventListener('click', () => {
            const messages = Array.from(chatContainer.children).map(el => {
                const sender = el.classList.contains('user-message') ? 'user' : 'ai';
                const text = el.querySelector('.message-bubble').innerText;
                return { sender, text, time: new Date().toISOString() };
            });

            const blob = new Blob([JSON.stringify({ session: currentSessionId, messages, user: currentUser }, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nexusai-conversation-${currentSessionId}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Conversation exported!', 'success');
        });

        // New Chat
        newChatBtn.addEventListener('click', () => {
            currentSessionId = generateSessionId();
            chatContainer.innerHTML = '';
            addMessage('ai', 'Hello! I’m your AI assistant. How can I help you today?');
            showToast('New chat started', 'success');
        });

        // Toast Notification
        function showToast(message, type = 'success') {
            toast.className = `toast ${type}`;
            toastText.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Welcome message
            setTimeout(() => {
                if (Math.random() > 0.5) {
                    addMessage('ai', '💡 Pro Tip: Press <kbd>Ctrl+Enter</kbd> to send messages quickly!');
                }
            }, 2000);
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                sendMessage();
            }
            if (e.ctrlKey && e.key === 'k') {
                e.preventDefault();
                messageInput.focus();
            }
        });

        // Handle paste image
        messageInput.addEventListener('paste', (e) => {
            const items = (e.clipboardData || e.originalEvent.clipboardData).items;
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf('image') !== -1) {
                    e.preventDefault();
                    const blob = items[i].getAsFile();
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        selectedImage = event.target.result;
                        previewImage.src = selectedImage;
                        previewCaption.textContent = 'Pasted image';
                        attachmentPreview.style.display = 'flex';
                    };
                    reader.readAsDataURL(blob);
                }
            }
        });

        // Prevent form submit on Enter in modals
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') e.preventDefault();
            });
        });
    </script>
</body>
</html>
